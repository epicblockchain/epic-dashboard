<html>
  <head>
    <meta charset="UTF-8">
    <title>ePIC Dashboard</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" href="node_modules/materialize-css/dist/css/materialize.min.css">
  </head>
  
  <!-- sidenav -->
  <!-- todo fix this disappearing on very small screens -->
  <div class="container">
    <ul id="nav" class="sidenav sidenav-fixed">
      <li>
        <div class="container">
          epic logo
        </div>  
      </li>
      <li><div class="divider"></div></li>
      <li id="nav-dashboard" class="nav-selector grey lighten-2"><a class="waves-effect">Dashboard</a></li>
      <li id="nav-charts" class="nav-selector"><a class="waves-effect">Charts</a></li>
      <li id="nav-market" class="nav-selector"><a class="waves-effect">Market</a></li>
      <li id="nav-pools" class="nav-selector"><a class="waves-effect">Pools</a></li>
      <li id="nav-settings" class="nav-selector"><a class="waves-effect">Settings</a></li>
    </ul>
  </div>
       
  <!-- dashboard page -->
  <div id="page-dashboard" class="container page">
    <div class="row">
      <div class="col s4">
        <div class="card blue">
          <div class="card-content white-text">
            <div class="card-content white-text">
              <span class="card-title">Loading...</span>
              <p>Pool hashrate</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s4">
        <div class="card red">
          <div class="card-content white-text">
            <div class="card-content white-text">
              <span class="card-title">Loading...</span>
              <p>s</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s4">
        <div class="card green">
          <div class="card-content white-text">
            <div class="card-content white-text">
              <span class="card-title">Loading...</span>
              <p>Uptime</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s4">
        <div class="card orange">
          <div class="card-content white-text">
            <div class="card-content white-text">
              <span class="card-title">Loading...</span>
              <p>s</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s4">
        <div class="card purple">
          <div class="card-content white-text">
            <div class="card-content white-text">
              <span class="card-title">Loading...</span>
              <p>s.</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s4">
        <div class="card yellow">
          <div class="card-content">
            <div class="card-content">
              <span class="card-title">Loading...</span>
              <p>I am a.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- charts page -->
  <div id="page-charts" class="container hide page">
    <div>
      <canvas id="someChart"></canvas>
    </div>
  </div>


  <!-- js stuff -->
  <script>
    window.jQuery = window.$ = require('jquery'); //jquery needs to be init like this because of node environment
  </script>
  <script src="node_modules/materialize-css/dist/js/materialize.min.js"></script>  
  <!-- <script src="custom/Worker.js"></script>
  <script src="custom/ChartManager.js"></script>
  <script src="custom/HBInfo.js"></script> -->
  <script>
    //to init the info and charts
    // var HB = new HBInfo();

    //materializecss inits
    //sidebar
    document.addEventListener('DOMContentLoaded', function() {
      var instances = M.Sidenav.init();//elems, options
    });
    $(document).ready(function(){
      $('.sidenav').sidenav();
    });

    //nav logic to highlight nav selector and show/hide page elements
    $('.nav-selector').click(function(event){
      //navbar highlighting
      var selector_id = $(this)[0].id;
      $(".nav-selector").removeClass("grey lighten-2");
      $(this).addClass("grey lighten-2");
      //page hiding / showing
      $(".page").addClass('hide'); //make sure this doesnt add the same class twice
      $("#page-"+selector_id.substr(4)).removeClass('hide');
    });

    //chart js
    var chartColors = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(201, 203, 207)'
      };

      function randomScalingFactor() {
        return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
      }

      function onRefresh(chart) {
        chart.config.data.datasets.forEach(function(dataset) {
          dataset.data.push({
            x: Date.now(),
            y: randomScalingFactor()
          });
        });
      }

      var color = Chart.helpers.color;
      var config = {
        type: 'line',
        data: {
          datasets: [{
            label: 'Dataset 1 (linear interpolation)',
            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
            borderColor: chartColors.red,
            fill: false,
            lineTension: 0,
            borderDash: [8, 4],
            data: []
          }, {
            label: 'Dataset 2 (cubic interpolation)',
            backgroundColor: color(chartColors.blue).alpha(0.5).rgbString(),
            borderColor: chartColors.blue,
            fill: false,
            cubicInterpolationMode: 'monotone',
            data: []
          }]
        },
        options: {
          title: {
            display: true,
            text: 'Line chart (hotizontal scroll) sample'
          },
          scales: {
            xAxes: [{
              type: 'realtime',
              realtime: {
                duration: 20000,
                refresh: 1000,
                delay: 2000,
                onRefresh: onRefresh
              }
            }],
            yAxes: [{
              scaleLabel: {
                display: true,
                labelString: 'value'
              }
            }]
          },
          tooltips: {
            mode: 'nearest',
            intersect: false
          },
          hover: {
            mode: 'nearest',
            intersect: false
          }
        }
      };

      window.onload = function() {
        var ctx = document.getElementById('myChart').getContext('2d');
        window.myChart = new Chart(ctx, config);
      };

      document.getElementById('randomizeData').addEventListener('click', function() {
        config.data.datasets.forEach(function(dataset) {
          dataset.data.forEach(function(dataObj) {
            dataObj.y = randomScalingFactor();
          });
        });
        window.myChart.update();
      });

      var colorNames = Object.keys(chartColors);
      document.getElementById('addDataset').addEventListener('click', function() {
        var colorName = colorNames[config.data.datasets.length % colorNames.length];
        var newColor = chartColors[colorName];
        var newDataset = {
          label: 'Dataset ' + (config.data.datasets.length + 1),
          backgroundColor: color(newColor).alpha(0.5).rgbString(),
          borderColor: newColor,
          fill: false,
          lineTension: 0,
          data: []
        };

        config.data.datasets.push(newDataset);
        window.myChart.update();
      });

      document.getElementById('removeDataset').addEventListener('click', function() {
        config.data.datasets.pop();
        window.myChart.update();
      });

      document.getElementById('addData').addEventListener('click', function() {
        onRefresh(window.myChart);
        window.myChart.update();
      });

  </script>
  </body>
</html>